// server/env.ts

type RequiredEnvVar = {
  key: string
  description: string
}

const REQUIRED_ENV_VARS: RequiredEnvVar[] = [
  { key: "DATABASE_URL", description: "Database connection string" },
  { key: "JWT_SECRET", description: "JWT signing secret" },
  { key: "OPENAI_API_KEY", description: "OpenAI API key" },
]

export function validateEnvironment() {
  const missing = REQUIRED_ENV_VARS.filter(
    (v) => !process.env[v.key] || process.env[v.key]?.trim() === ""
  )

  if (missing.length > 0) {
    console.error("❌ Missing required environment variables:")
    missing.forEach((v) =>
      console.error(`- ${v.key}: ${v.description}`)
    )

    throw new Error(
      `Missing ${missing.length} required environment variable(s). Server startup aborted.`
    )
  }

  console.log("✅ Environment variables validated")
}
